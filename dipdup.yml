spec_version: 1.2
package: demo_uniswap

database:
  kind: sqlite
  path: demo-uniswap.sqlite3

datasources:
  ethscan:
    kind: abi.etherscan

  mainnet_node:
    kind: evm.node
    url: https://mainnet.infura.io/v3/${INFURA_KEY}
    ws_url: wss://mainnet.infura.io/ws/v3/${INFURA_KEY}

  mainnet_subsquid:
    kind: evm.subsquid
    url: ${ARCHIVE_URL:-https://eth.archive.subsquid.io}
    node: mainnet_node

contracts:
  factory:
    kind: evm
    address: 0x1F98431c8aD98523631AE4a59f267346ea31F984
    typename: factory
  position_manager:
    kind: evm
    address: 0xC36442b4a4522E871399CD717aBDD847Ab11FE88
    typename: position_manager
  pool:
    kind: evm
    address: 0x7668B2Ea8490955F68F5c33E77FE150066c94fb9
    typename: pool

templates:
  uniswap_v3_factory:
    kind: evm.subsquid.events
    datasource: <datasource>
    handlers:
      - callback: factory.pool_created
        contract: factory
        name: PoolCreated
      - callback: position_manager.increase_liquidity
        contract: position_manager
        name: IncreaseLiquidity
      - callback: position_manager.decrease_liquidity
        contract: position_manager
        name: DecreaseLiquidity
      - callback: position_manager.collect
        contract: position_manager
        name: Collect
      - callback: position_manager.transfer
        contract: position_manager
        name: Transfer

  uniswap_pool:
    kind: evm.subsquid.events
    datasource: <datasource>
    handlers:
      - callback: pool.initialize
        contract: <pool>
        name: Initialize
      - callback: pool.swap
        contract: <pool>
        name: Swap
      - callback: pool.mint
        contract: <pool>
        name: Mint
      - callback: pool.burn
        contract: <pool>
        name: Burn
      - callback: pool.flash
        contract: <pool>
        name: Flash

indexes:
  uniswap_mainnet:
    template: uniswap_v3_factory
    values:
      datasource: mainnet_subsquid
    first_level: 12369621
  
  # pool_example:
  #   template: uniswap_pool
  #   values:
  #     datasource: mainnet_subsquid
  #     pool: pool
  #   first_level: 12369621

advanced:
  early_realtime: True
logging: verbose