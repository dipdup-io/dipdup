---
title: "Monitoring"
description: "To perform up-to-date and freshness checks, DipDup provides a standard REST endpoint you can use together with Betteruptime or similar services that can search for a keyword in the response."
---

<!-- markdownlint-disable -->

# Monitoring

It's important to configure your monitoring to know that your indexer is working properly. DipDup provides multiple ways to monitor your indexer:

- Prometheus integration
- Internal database tables and views
- Monitoring API endpoint
- Sentry integration

## Monitoring endpoint

You can use API endpoint to get the various indexing stats. First, enable internal API in config:

```yaml
api: {}
```

By default, DipDup will listen on `0.0.0.0:46339`. Query the `/performance` endpoint:

```sh
curl http://0.0.0.0:46339/performance
```

## Internal tables

DipDup uses a set of internal tables to keep track of indexing stats. See the [Internal tables](../1.getting-started/5.database.md#internal-tables) page for details.

Additionally, metrics returned by the monitoring endpoint are stored in the `dipdup_meta` table in JSON format. You can use `dipdup_status` database view to get a nice summary.

Via SQL:

```sh
sqlite> select * from dipdup_status;
type        name                       level     size    updated_at
----------  -------------------------  --------  ------  --------------------------------
index       eth_usdt_events            8211425   0       2024-09-09 20:33:07.482867+00:00
datasource  subsquid                   20714000  0       2024-09-09 20:22:38.486122+00:00
queue       eth_usdt_events:realtime   0         0       2024-09-09 20:33:04.493736+00:00
queue       eth_usdt_events:readahead  0         9171    2024-09-09 20:33:04.493736+00:00
cache       model:Holder               0         262144  2024-09-09 20:33:04.493736+00:00
```

Via Hasura:

```sh
curl http://0.0.0.0:8000/api/rest/dipdup_head_status?name=eth_events
```

You can also create your custom alert endpoints using SQL views and functions; see the [SQL scripts](../1.getting-started/5.database.md#sql-scripts) page for details.

## Sentry

Sentry is an error tracking software that can be used either as a service or on-premise. It dramatically improves the troubleshooting experience and requires nearly zero configuration. To start catching exceptions with Sentry in your project, add the following section in `dipdup.yaml` config:

```yaml [dipdup.yaml]
sentry:
  dsn: https://example.com
  environment: dev
  debug: False
```

You can obtain Sentry DSN from the web interface at _Settings -> Projects -> <project\_name> -> Client Keys (DSN)_. The cool thing is that if you catch an exception and suspect there's a bug in DipDup, you can share this event with us using a public link (created at _Share_ menu).

## Prometheus

DipDup provides integration with the Prometheus monitoring system. To enable the integration and listen on `0.0.0.0:9000`, add the following section to the config:

```yaml
prometheus: {}
```

The following metrics are exposed under `dipdup` namespace:

| metric name                                    | description                                         | type      |
| ---------------------------------------------- | --------------------------------------------------- | --------- |
| `dipdup_indexes_total`                         | Number of indexes in operation by status            | counter   |
| `dipdup_index_total_sync_duration_seconds`     | Duration of the last index synchronization          | histogram |
| `dipdup_index_total_realtime_duration_seconds` | Duration of the last index realtime synchronization | histogram |
| `dipdup_index_levels_to_sync_total`            | Number of levels to reach synced state              | histogram |
| `dipdup_index_levels_to_realtime_total`        | Number of levels to reach realtime state            | histogram |
| `dipdup_datasource_head_updated_timestamp`     | Timestamp of the last head update                   | histogram |
| `dipdup_datasource_rollbacks_total`            | Number of rollbacks                                 | counter   |
| `dipdup_http_errors_total`                     | Number of HTTP errors                               | counter   |
| `dipdup_http_errors_in_row`                    | Number of consecutive failed requests               | histogram |
| `dipdup_levels_indexed_total`                  | Total number of levels indexed                      | gauge     |
| `dipdup_levels_nonempty_total`                 | Total number of nonempty levels indexed             | counter   |
| `dipdup_levels_total`                          | Total number of levels                              | gauge     |
| `dipdup_objects_indexed_total`                 | Total number of objects indexed                     | counter   |
| `dipdup_index_handlers_matched_total`          | Index total hits                                    | gauge     |
| `dipdup_index_time_in_matcher_seconds`         | Time spent in matcher                               | histogram |
| `dipdup_index_time_in_callbacks_seconds`       | Time spent in callbacks                             | histogram |
| `dipdup_datasource_time_in_requests_seconds`   | Time spent in datasource requests                   | histogram |
| `dipdup_datasource_requests_total`             | Total number of datasource requests                 | counter   |
| `dipdup_started_at_timestamp`                  | Timestamp of the DipDup start                       | gauge     |
| `dipdup_synchronized_at_timestamp`             | Timestamp of the last synchronization               | gauge     |
| `dipdup_realtime_at_timestamp`                 | Timestamp of the last realtime update               | gauge     |
| `dipdup_metrics_updated_at_timestamp`          | Timestamp of the last metrics update                | gauge     |
| `dipdup_levels_speed`                          | Levels per second                                   | gauge     |
| `dipdup_levels_speed_average`                  | Average levels per second                           | gauge     |
| `dipdup_levels_nonempty_speed`                 | Nonempty levels per second                          | gauge     |
| `dipdup_objects_speed`                         | Objects per second                                  | gauge     |
| `dipdup_time_passed_seconds`                   | Time passed since the start                         | gauge     |
| `dipdup_time_left_seconds`                     | Time left estimated until the end                   | gauge     |
| `dipdup_progress`                              | Progress in percents                                | gauge     |

Also, DipDup exposes the following metrics for compatibility with [Subsquid Cloud](https://app.subsquid.io/):

| metric name                                | description                                               | type      |
| ------------------------------------------ | --------------------------------------------------------- | --------- |
| `sqd_processor_last_block`                 | Level of the last processed block from Subsquid Network   | gauge     |
| `sqd_processor_chain_height`               | Current chain height as reported by Subsquid Network      | gauge     |
| `sqd_processor_archive_http_errors_in_row` | Number of consecutive failed requests to Subsquid Network | histogram |

## Logging

To control the number of logs DipDup produces, set the `logging` field in config. It can be either a string or a mapping from logger names to logging levels.

```yaml [dipdup.yaml]
# Configure dipdup and package loggers
logging: WARN

# Increase verbosity of some loggers
logging:
  dipdup.database: DEBUG
  aiosqlite: DEBUG

# Enable ALL logs
logging:
  '': DEBUG
```

By default only `dipdup` and `dipdup_indexer` namespace loggers are configured. DipDup loggers are usually named after the corresponding module, e.g., `dipdup.database` or `dipdup.index`.

Keep in mind, that excessive logging can affect indexing performance.

If you need your logs in JSON format, use `DIPDUP_JSON_LOG=1` environment variable.
