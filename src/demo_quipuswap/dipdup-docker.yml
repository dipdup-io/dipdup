spec_version: 0.0.1
package: demo_quipuswap

database:
  kind: postgres
  host: db
  port: 5432
  user: dipdup
  password: changeme
  database: dipdup
  schema_name: quipuswap

hasura:
  url: http://hasura:8080
  admin_secret: changeme

contracts:
  kusd_dex_mainnet:
    address: KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2
    typename: quipu_fa12
  tzbtc_dex_mainnet:
    address: KT1N1wwNPqT5jGhM91GQ2ae5uY8UzFaXHMJS
    typename: quipu_fa12
  kusd_token_mainnet:
    address: KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV
    typename: fa12_token
  tzbtc_token_mainnet:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: fa12_token
  hdao_dex_mainnet:
    address: KT1V41fGzkdTJki4d11T1Rp9yPkCmDhB7jph
    typename: quipu_fa2
  hdao_token_mainnet:
    address: KT1AFA2mwNUMNd4SsujE1YYp29vd8BZejyKW
    typename: fa2_token

datasources:
  tzkt_staging_mainnet:
    kind: tzkt
    url: https://staging.api.tzkt.io

templates:
  quipuswap_fa12:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_fa12_token_to_tez
        pattern:
          - destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_tez_to_token
        pattern:
          - destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_invest_liquidity
        pattern:
          - destination: <dex_contract>
            entrypoint: investLiquidity
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_divest_liquidity
        pattern:
          - destination: <dex_contract>
            entrypoint: divestLiquidity
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_withdraw_profit
        pattern:
          - destination: <dex_contract>
            entrypoint: withdrawProfit

  quipuswap_fa2:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_fa2_token_to_tez
        pattern:
          - destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa2_tez_to_token
        pattern:
          - destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_invest_liquidity
        pattern:
          - destination: <dex_contract>
            entrypoint: investLiquidity
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_divest_liquidity
        pattern:
          - destination: <dex_contract>
            entrypoint: divestLiquidity
          - destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_withdraw_profit
        pattern:
          - destination: <dex_contract>
            entrypoint: withdrawProfit

indexes:
  kusd_mainnet:
    template: quipuswap_fa12
    values:
      dex_contract: kusd_dex_mainnet
      token_contract: kusd_token_mainnet
      symbol: kUSD
      decimals: 18

  # tzbtc_mainnet:
  #   template: quipuswap_fa12
  #   values:
  #     dex_contract: tzbtc_dex_mainnet
  #     token_contract: tzbtc_token_mainnet
  #     symbol: tzBTC
  #     decimals: 8

  hdao_mainnet:
    template: quipuswap_fa2
    values:
      dex_contract: hdao_dex_mainnet
      token_contract: hdao_token_mainnet
      symbol: hDAO
      decimals: 6
