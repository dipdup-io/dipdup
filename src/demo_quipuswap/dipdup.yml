spec_version: 0.1
package: demo_quipuswap

database:
  kind: sqlite
  path: quipuswap.sqlite3

contracts:
  kusd_dex_mainnet:
    address: KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2
    typename: quipuswap_fa12
  tzbtc_dex_mainnet:
    address: KT1N1wwNPqT5jGhM91GQ2ae5uY8UzFaXHMJS
    typename: quipuswap_fa12
  kusd_token_mainnet:
    address: KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV
    typename: token_fa12
  tzbtc_token_mainnet:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: token_fa12
  hdao_dex_mainnet:
    address: KT1V41fGzkdTJki4d11T1Rp9yPkCmDhB7jph
    typename: quipuswap_fa2
  hdao_token_mainnet:
    address: KT1AFA2mwNUMNd4SsujE1YYp29vd8BZejyKW
    typename: token_fa2

datasources:
  tzkt_staging_mainnet:
    kind: tzkt
    url: https://staging.api.tzkt.io

templates:
  quipuswap_fa12:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_token_fa12_to_tez
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_tez_to_token
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_invest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: investLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_divest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: divestLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_withdraw_profit
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: withdrawProfit
          - type: transaction
            source: <dex_contract>
            optional: True

  quipuswap_fa2:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_token_fa2_to_tez
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa2_tez_to_token
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_invest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: investLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_divest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: divestLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_withdraw_profit
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: withdrawProfit
          - type: transaction
            source: <dex_contract>
            optional: True

indexes:
  kusd_mainnet:
    template: quipuswap_fa12
    values:
      dex_contract: kusd_dex_mainnet
      token_contract: kusd_token_mainnet
      symbol: kUSD
      decimals: 18

  # tzbtc_mainnet:
  #   template: quipuswap_fa12
  #   values:
  #     dex_contract: tzbtc_dex_mainnet
  #     token_contract: tzbtc_token_mainnet
  #     symbol: tzBTC
  #     decimals: 8

  hdao_mainnet:
    template: quipuswap_fa2
    values:
      dex_contract: hdao_dex_mainnet
      token_contract: hdao_token_mainnet
      symbol: hDAO
      decimals: 6
