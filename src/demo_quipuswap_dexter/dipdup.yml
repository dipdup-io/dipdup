spec_version: 0.1
package: demo_quipuswap_dexter

database:
  kind: sqlite
  path: quipuswap_dexter.sqlite3

contracts:
  quipuswap_kusd_dex_mainnet:
    address: KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2
    typename: quipu_fa12
  quipuswap_tzbtc_dex_mainnet:
    address: KT1N1wwNPqT5jGhM91GQ2ae5uY8UzFaXHMJS
    typename: quipu_fa12
  kusd_token_mainnet:
    address: KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV
    typename: fa12_token
  tzbtc_token_mainnet:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: fa12_token
  quipuswap_hdao_dex_mainnet:
    address: KT1V41fGzkdTJki4d11T1Rp9yPkCmDhB7jph
    typename: quipu_fa2
  hdao_token_mainnet:
    address: KT1AFA2mwNUMNd4SsujE1YYp29vd8BZejyKW
    typename: fa2_token
  dexter_tzbtc_dex_mainnet:
    address: KT1BGQR7t4izzKZ7eRodKWTodAsM23P38v7N
    typename: dexter_fa12

datasources:
  tzkt_staging_mainnet:
    kind: tzkt
    url: https://staging.api.tzkt.io

templates:
  quipuswap_fa12:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_fa12_token_to_tez
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_tez_to_token
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_invest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: investLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_divest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: divestLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_withdraw_profit
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: withdrawProfit
          - type: transaction
            source: <dex_contract>
            optional: True

  quipuswap_fa2:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_fa2_token_to_tez
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tokenToTezPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa2_tez_to_token
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tezToTokenPayment
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_invest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: investLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_divest_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: divestLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa20_withdraw_profit
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: withdrawProfit
          - type: transaction
            source: <dex_contract>
            optional: True

  dexter_fa12:
    kind: operation
    datasource: tzkt_staging_mainnet
    contracts:
      - <dex_contract>
    handlers:
      - callback: on_fa12_token_to_xtz
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: tokenToXtz
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_xtz_to_token
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: xtzToToken
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_add_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: addLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer
      - callback: on_fa12_remove_liquidity
        pattern:
          - type: transaction
            destination: <dex_contract>
            entrypoint: removeLiquidity
          - type: transaction
            destination: <token_contract>
            entrypoint: transfer

indexes:
  quipuswap_kusd_mainnet:
    template: quipuswap_fa12
    values:
      dex_contract: quipuswap_kusd_dex_mainnet
      token_contract: kusd_token_mainnet
      symbol: kUSD
      decimals: 18

  # tzbtc_mainnet:
  #   template: quipuswap_fa12
  #   values:
  #     dex_contract: quipuswap_tzbtc_dex_mainnet
  #     token_contract: tzbtc_token_mainnet
  #     symbol: tzBTC
  #     decimals: 8

  quipuswap_hdao_mainnet:
    template: quipuswap_fa2
    values:
      dex_contract: quipuswap_hdao_dex_mainnet
      token_contract: hdao_token_mainnet
      symbol: hDAO
      decimals: 6

  dexter_tzbtc_mainnet:
    template: dexter_fa12
    values:
      dex_contract: dexter_tzbtc_dex_mainnet
      token_contract: tzbtc_token_mainnet
      symbol: tzBTC
      decimals: 8