spec_version: 0.0.1
package: dipdup_quipuswap

database:
  kind: sqlite
  path: db.sqlite3

contracts:
  kusd_dex:
    address: ${KUSD_DEX:-KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2}
  kusd_token: 
    address: ${KUSD_TOKEN:-KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV}
  hdao_dex: 
    address: ${HDAO_DEX:-KT1V41fGzkdTJki4d11T1Rp9yPkCmDhB7jph}
  hdao_token: 
    address: ${HDAO_TOKEN:-KT1AFA2mwNUMNd4SsujE1YYp29vd8BZejyKW}

datasources:
  tzkt_staging:
    kind: tzkt
    url: ${TZKT_URL:-https://staging.api.tzkt.io}

templates:
  trades_fa12:
    kind: operation
    datasource: tzkt_staging
    contract: <dex>
    handlers:
      - callback: on_fa12_token_to_tez
        pattern:
          - destination: <dex>
            entrypoint: tokenToTezPayment
          - destination: <token>
            entrypoint: transfer
      - callback: on_fa12_tez_to_token
        pattern:
          - destination: <dex>
            entrypoint: tezToTokenPayment
          - destination: <token>
            entrypoint: transfer

  trades_fa2:
    kind: operation
    datasource: tzkt_staging
    contract: <dex>
    handlers:
      - callback: on_fa2_token_to_tez
        pattern:
          - destination: <dex>
            entrypoint: tokenToTezPayment
          - destination: <token>
            entrypoint: transfer
      - callback: on_fa2_tez_to_token
        pattern:
          - destination: <dex>
            entrypoint: tezToTokenPayment
          - destination: <token>
            entrypoint: transfer

indexes:
  trades_fa12:
    template: trades_fa12
    values:
      dex: kusd_dex
      token: kusd_token
      symbol: kUSD

  trades_fa20:
    template: trades_fa2
    values:
      dex: hdao_dex
      token: hdao_token
      symbol: hDAO