spec_version: 0.0.1
package: dipdup_quipuswap

database:
  kind: sqlite
  path: db.sqlite3

contracts:
  kusd_dex:
    address: ${KUSD_DEX:-KT1CiSKXR68qYSxnbzjwvfeMCRburaSDonT2}
    typename: fa12_dex
  kusd_token:
    address: ${KUSD_TOKEN:-KT1K9gCRgaLRFKTErYt1wVxA3Frb9FjasjTV}
    typename: fa12_token
  tzbtc_dex:
    address: KT1N1wwNPqT5jGhM91GQ2ae5uY8UzFaXHMJS
    typename: fa12_dex
  tzbtc_token:
    address: KT1PWx2mnDueood7fEmfbBDKx1D9BAnnXitn
    typename: fa12_token

datasources:
  tzkt_staging:
    kind: tzkt
    url: ${TZKT_URL:-https://staging.api.tzkt.io}

templates:
  trades_fa12:
    kind: operation
    datasource: tzkt_staging
    contract: <dex>
    handlers:
      - callback: on_fa12_token_to_tez
        pattern:
          - destination: <dex>
            entrypoint: tokenToTezPayment
          - destination: <token>
            entrypoint: transfer
      - callback: on_fa12_tez_to_token
        pattern:
          - destination: <dex>
            entrypoint: tezToTokenPayment
          - destination: <token>
            entrypoint: transfer

indexes:
  trades_kusd:
    template: trades_fa12
    values:
      dex: kusd_dex
      token: kusd_token
      symbol: kUSD
  trades_tzbtc:
    template: trades_fa12
    values:
      dex: tzbtc_dex
      token: tzbtc_token
      symbol: tzBTC